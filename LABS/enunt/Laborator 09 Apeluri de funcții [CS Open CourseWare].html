<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" dir="ltr" lang="en"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>
    Laborator 09: Apeluri de func»õii    [CS Open CourseWare]
  </title>

  <meta name="generator" content="DokuWiki">
<meta name="robots" content="index,follow">
<meta name="date" content="2022-05-06T15:02:51+0300">
<meta name="keywords" content="iocla,laboratoare,laborator-09">
<link rel="search" type="application/opensearchdescription+xml" href="https://ocw.cs.pub.ro/courses/lib/exe/opensearch.php" title="CS Open CourseWare">
<link rel="start" href="https://ocw.cs.pub.ro/courses/">
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="https://ocw.cs.pub.ro/courses/feed.php">
<link rel="alternate" type="application/rss+xml" title="Current Namespace" href="https://ocw.cs.pub.ro/courses/feed.php?mode=list&amp;ns=iocla:laboratoare">
<link rel="alternate" type="text/html" title="Plain HTML" href="https://ocw.cs.pub.ro/courses/_export/xhtml/iocla/laboratoare/laborator-09">
<link rel="canonical" href="http://ocw.cs.pub.ro/courses/iocla/laboratoare/laborator-09">
<link rel="stylesheet" type="text/css" href="Laborator%2009%20Apeluri%20de%20func%C8%9Bii%20[CS%20Open%20CourseWare]_files/css.css">
<script type="text/javascript">/*<![CDATA[*/var NS='iocla:laboratoare';var JSINFO = {"id":"iocla:laboratoare:laborator-09","namespace":"iocla:laboratoare","isadmin":0,"isauth":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="Laborator%2009%20Apeluri%20de%20func%C8%9Bii%20[CS%20Open%20CourseWare]_files/js.php"></script>
<script type="text/x-mathjax-config;executed=true">/*<![CDATA[*/MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ["$","$"], ["\\(","\\)"] ],
        displayMath: [ ["$$","$$"], ["\\[","\\]"] ],
        processEscapes: true
    }
});
/*!]]>*/</script>
<script src="Laborator%2009%20Apeluri%20de%20func%C8%9Bii%20[CS%20Open%20CourseWare]_files/MathJax.js" id=""></script>
<script type="text/javascript">/*<![CDATA[*/
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
		  
/*!]]>*/</script><script src="Laborator%2009%20Apeluri%20de%20func%C8%9Bii%20[CS%20Open%20CourseWare]_files/ga.js" type="text/javascript"></script>
<script type="text/javascript">/*<![CDATA[*/
var pageTracker = _gat._getTracker("UA-38383934-1");
pageTracker._initData();
pageTracker._trackPageview();
		  
/*!]]>*/</script>

  <link rel="shortcut icon" href="https://ocw.cs.pub.ro/courses/lib/tpl/arctic/images/favicon.ico">

  
<style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck.RTL {right: .7em; left: auto}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1px; bottom: 2px; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style></head>
<body><div id="MathJax_Message" style="display: none;"></div>
<div id="wrapper" class="show">
  <div class="dokuwiki">

    
    <div class="stylehead">
      <div class="header">
        <div class="pagename">
          <a href="https://ocw.cs.pub.ro/courses/iocla/"><img src="Laborator%2009%20Apeluri%20de%20func%C8%9Bii%20[CS%20Open%20CourseWare]_files/sigla_iocla.png" height="70"> </a>        </div>
        <div class="logo">
          <a style="color: #AAA !important;" href="https://ocw.cs.pub.ro/courses/">Open CourseWare</a>        </div>
      </div>
    
       
      <div class="breadcrumbs">
              </div>
      
            </div>

                  <div class="bar" id="bar__top">
        <div class="bar-left">
                  </div>
        <div class="bar-right">
          <a href="https://ocw.cs.pub.ro/courses/iocla/laboratoare/laborator-09?do=recent" class="action recent" accesskey="r" rel="nofollow" title="Recent changes [R]">Recent changes</a><a href="https://ocw.cs.pub.ro/courses/iocla/laboratoare/laborator-09?do=login&amp;sectok=8d3aa058a24de10968580638a9354752" class="action login" rel="nofollow" title="Login">Login</a>        </div>
    </div>
        
    
    
    
              <div class="left_page">
          
<h1 class="sectionedit1" id="laborator_09apeluri_de_functii">Laborator 09: Apeluri de func»õii</h1>
<div class="level1">

<p>
√én acest laborator vom prezenta modul √Æn care se realizeazƒÉ apeluri de func»õii. Vom vedea cum putem folosi instruc»õiunile <code>call</code> »ôi <code>ret</code> pentru a realiza apeluri de func»õii »ôi cum folosim stiva pentru a transmite parametrii unei func»õii.
</p>

<p>
Laboratorul este de forma <em>learn by doing</em>, partea practicƒÉ 
altern√¢nd √Æntre sec»õiuni de tip tutorial, cu parcurgere pas cu pas »ôi 
prezentarea solu»õiei, »ôi exerci»õii care trebuie sƒÉ fie rezolvate.
</p>

</div>

<h2 class="sectionedit2" id="cunostinte_si_abilitati_ce_vor_fi_dobandite">Cuno»ôtin»õe »ôi abilitƒÉ»õi ce vor fi dob√¢ndite</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Traducerea apelului »ôi implementƒÉrii unei func»õii din limbajul C √Æn limbaj de asamblare</div>
</li>
<li class="level1"><div class="li"> Transmiterea parametrilor in diferite arhitecturi.</div>
</li>
<li class="level1"><div class="li"> Folosirea instruc»õiunilor <code>call</code> »ôi <code>ret</code> pentru a realiza un apel de func»õie</div>
</li>
<li class="level1"><div class="li"> Implementarea unei func»õii √Æn limbaj de asamblare</div>
</li>
<li class="level1"><div class="li"> Folosirea stivei pentru a transmite parametrii unei func»õii</div>
</li>
<li class="level1"><div class="li"> Apelarea unei func»õii externe (aflatƒÉ √Æn biblioteca standard C) din limbaj de asamblare</div>
</li>
</ul>

</div>

<h2 class="sectionedit3" id="transmiterea_parametrilor">Transmiterea Parametrilor</h2>
<div class="level2">

<p>
Cand vine vorba de a chema o functie cu parametri exista doua mari optiuni de plasare a acestora:
</p>

<p>
1. <strong>Plasarea in registre</strong> - aceasta metoda, in mod intuitiv, presupune transmiterea parametrilor cu ajutorul registrelor.
</p>

<p>
<strong>Avantaje</strong>
</p>
<ul>
<li class="level1"><div class="li"> Este foarte usor de folosit atunci cand numarul parametrilor este mic.</div>
</li>
<li class="level1"><div class="li"> Este foarte rapida, intrucat parametrii sunt imediat accesibili din registre.</div>
</li>
</ul>

<p>
<strong>Dezavantaje</strong>
</p>
<ul>
<li class="level1"><div class="li"> Din cauza faptului ca exista un numar limitat de registre, numarul de parametri ai unei functii ajunge sa fie limitat.</div>
</li>
<li class="level1"><div class="li"> E foarte probabil ca unele registre 
sa fie folosite in interiorul functiei apelate si devine necesara 
salvarea temporara a registrelor pe stiva inaintea apeluluide functie. 
Astfel, cel de-al doilea avantaj enumerat dispare, deoarece accesul la 
stiva presupune lucru cu memoria, adica latenta crescuta.</div>
</li>
</ul>

<p>
2. <strong>Plasarea pe stivƒÉ</strong> - aceasta metoda presupune push-uirea pe stiva a tuturor parametrilor.
</p>

<p>
<strong>Avantaje</strong>
</p>
<ul>
<li class="level1"><div class="li"> Poate fi transmis un numar mare de parametri.</div>
</li>
</ul>

<p>
<strong>Dezavantaje</strong>
</p>
<ul>
<li class="level1"><div class="li"> Este lenta intrucat se face acces la memorie.</div>
</li>
<li class="level1"><div class="li"> Mai complicata din punct de vedere al accesului la parametri.</div>
</li>
</ul>

<p>
</p><p></p><div class="noteclassic"> Pentru arhitecturiile <strong>32-bit</strong> se foloseste metoda plasarii pe stiva, iar pentru cele <strong>64-bit</strong> se foloseste metoda plasarii in registre. Noi vom folosi conventia de la 32-bit architecture. 
</div><p></p>
<p></p>

</div>

<h2 class="sectionedit4" id="apelul_unei_functii">Apelul unei func»õii</h2>
<div class="level2">

<p>
Atunci c√¢nd apelƒÉm o func»õie, pa»ôii sunt urmƒÉtorii:
</p>
<ul>
<li class="level1"><div class="li"> Punem argumentele pe stivƒÉ, apelul de tip push fiind √Æn ordinea inversƒÉ √Æn care sunt trimi»ôi ca argumente func»õiei.</div>
</li>
<li class="level1"><div class="li"> ApelƒÉm <code>call</code>.</div>
</li>
<li class="level1"><div class="li"> RestaurƒÉm stiva la sf√¢r»ôitul apelului.</div>
</li>
</ul>

</div>

<h3 class="sectionedit5" id="functionarea_stivei">Func»õionarea stivei</h3>
<div class="level3">

<p>
DupƒÉ cum »ôtim, opera»õiile pe stivƒÉ sunt de douƒÉ tipuri:
</p>
<ul>
<li class="level1"><div class="li"> <code>push val</code> √Æn care valoarea <code>val</code> este plasatƒÉ pe stivƒÉ</div>
</li>
<li class="level1"><div class="li"> <code>pop reg/mem</code> √Æn care ce se gƒÉse»ôte √Æn v√¢rful stivei se plaseazƒÉ √Æn registru sau √Æntr-o zonƒÉ de memorie</div>
</li>
</ul>

<p>
√én momentul √Æn care se face <code>push</code> spunem cƒÉ stiva <strong>cre»ôte</strong> (se adaugƒÉ elemente). Din motive ce vor fi explicate mai bine la SO, pointerul de stivƒÉ (indicat de registrul <code>esp</code> pe 32 de bi»õi) scade in valoare atunci cand <strong>stiva creste</strong> (la <code>push</code>).
 Putem spune totusi ca aceasta contrazicere in numire vine de la faptul 
ca stiva este deregula reprezentata pe verticala si valorile mici se 
afla sus, iar valorile mari se afla jos.
</p>

<p>
La fel, √Æn momentul √Æn care facem <code>pop</code> spunem cƒÉ stiva <strong>scade</strong> (se scot elemente). Acum pointer-ul de stivƒÉ (indicat de registrul <code>esp</code> pe 32 de bi»õi) cre»ôte valoric.
</p>

<p>
Un sumar al acestui lucru este explicat foarte bine la acest <a href="https://en.wikibooks.org/wiki/X86_Disassembly/The_Stack" class="urlextern" title="https://en.wikibooks.org/wiki/X86_Disassembly/The_Stack" rel="nofollow">link</a>.
</p>

<p>
Spre exemplu, daca avem functia foo cu urmatoarea semnatura (in limbaj C):
</p>
<pre class="code">int foo(int a, int b, int c);
</pre>

<p>
Apelul acestei functii va arata astfel:
</p>
<pre class="code">mov ecx, [c]     ; luam valoarea parametrului c dintr-o zona de memorie
mov ebx, [b]
mov eax, [a]

push ecx         ; punem parametrii in ordine inversa, incepand cu c
push ebx         ; apoi b
push eax         ; apoi a
call foo         ; apelam functia
add esp, 12      ; restauram stiva
</pre>

</div>

<h2 class="sectionedit6" id="apelantul_si_apelatul">Apelantul si Apelatul</h2>
<div class="level2">

<p>
Atunci c√¢nd apelƒÉm o func»õie spunem cƒÉ func»õia care apeleazƒÉ (contextul care apeleazƒÉ) se cheamƒÉ <strong>apelant</strong> (sau <strong>caller</strong>), iar func»õia apelatƒÉ se cheamƒÉ <strong>apelat</strong> (sau <strong>callee</strong>). In paragraful anterior am discutat despre cum aratƒÉ lucrurile la nivelul apelantului (cum construim stiva).
</p>

<p>
Haide»õi sƒÉ urmƒÉrim ce se √Ænt√¢mplƒÉ si la la nivelul apelatului. P√¢nƒÉ √Æn momentul instruc»õiunii <code>call</code> stiva con»õine parametrii func»õiei. Apelul <code>call</code> poate fi echivalat grosier urmƒÉtoarei secven»õe:
</p>
<pre class="code">push eip
jmp function_name
</pre>

<p>
AdicƒÉ »ôi apelul <code>call</code> folose»ôte √Æn continuare stiva »ôi salveazƒÉ adresa urmƒÉtoarei instruc»õiuni, cea de dupƒÉ <code>call</code>
 numitƒÉ »ôi instruc»õiunea de retur sau adresa de retur (return address). 
Aceasta este necesarƒÉ pentru a »ôti, √Æn apelat, unde sƒÉ revenim √Æn 
apelant.
</p>

<p>
√én apelat, la √Ænceputul sƒÉu (numit preambul, preamble) se salveazƒÉ frame
 pointer-ul (√Æn arhitectura i386 este vorba de registrul <code>ebp</code>)
 urm√¢nd ca frame pointer-ul sƒÉ refere adresa curentƒÉ de pe stivƒÉ (adicƒÉ 
tocmai fostul frame pointer). De»ôi nu este obligatorie, salvarea frame 
pointer-ului ajutƒÉ la debugging »ôi este √Æn cele mai multe cazuri 
folositƒÉ. Din aceste motive, orice apel de func»õie va avea √Æn general, 
preambulul:
</p>
<pre class="code">push ebp
mov ebp, esp
</pre>

<p>
Aceste modificƒÉri au loc √Æn apelat. De aceea este responsabilitatea 
acestuia sƒÉ restaureze stiva la vechea sa valoare. De aceea este uzualƒÉ 
existen»õa unui epilog care sƒÉ readucƒÉ stiva la starea sa ini»õialƒÉ; acest
 epilog este:
</p>
<pre class="code">leave
</pre>

<p>
Dupa aceasta instructiune, stiva este ca la √Ænceputul func»õiei (adicƒÉ imediat dupƒÉ call).
</p>

<p>
Pentru incheierea functiei, este necesar ca executia codului sa se 
intoarca (return) si sa continue sa execute de la instructiunea de dupa <code>call</code>-ul care a pornit functia. Acest lucru presupune sa influentam registrul <code>eip</code> si sa punem valoarea care a fost salvata pe stiva initial de apelul <code>call</code>. Acest lucru este indeplinit folosind instructiunea:
</p>
<pre class="code">ret
</pre>

<p>
care este grosier echivalentul instruc»õiunii:
</p>
<pre class="code">pop eip
</pre>

<p>
Spre exemplu, definitia si corpul functiei foo, care realizeaza suma a 3 numere, vor arata astfel:
</p>
<pre class="code">foo:
    push ebp
    mov ebp, esp

    mov eax, [ebp + 8]
    mov ebx, [ebp + 12]
    mov ecx, [ebp + 16]

    add eax, ebx
    add eax, ecx

    leave
    ret
</pre>

</div>

<h3 class="sectionedit7" id="remarcati">Remarcati:</h3>
<div class="level3">

<p>
1. O functie se defineste printr-un label.
2. Dupa preambulul functiei, stiva arata in felul urmator:
</p>

<p>
<a href="https://ocw.cs.pub.ro/courses/lib/exe/fetch.php?hash=b29a11&amp;media=https%3A%2F%2Fraw.githubusercontent.com%2Fsystems-cs-pub-ro%2Fiocla%2Fmaster%2Flaborator%2Fcontent%2Fapel-functii%2Fimages%2Ffunction_stack1.jpg" class="media" title="https://raw.githubusercontent.com/systems-cs-pub-ro/iocla/master/laborator/content/apel-functii/images/function_stack1.jpg"><img src="Laborator%2009%20Apeluri%20de%20func%C8%9Bii%20[CS%20Open%20CourseWare]_files/fetch.jpeg" class="media" title="function_stack1.jpg" alt="function_stack1.jpg" width="650"></a>
</p>

<p>
3. De observat cƒÉ pe parcursul execu»õiei func»õiei, ceea ce nu se schimbƒÉ
 este pozi»õia frame pointer-ul. Acesta este »ôi motivul denumirii sale: 
pointeazƒÉ la frame-ul curent al func»õiei. De aceea este comun ca 
accesarea parametrilor unei func»õii sƒÉ se realizeze prin intermediul 
frame pointer-ului. Presupun√¢nd un sistem pe 32 de bi»õi »ôi parametri de 
dimensiunea cuv√¢ntului procesorului (32 de bi»õi, 4 octe»õi) vom avea:
</p>
<ul>
<li class="level1"><div class="li"> primul argument se gƒÉse»ôte la adresa <code>ebp+8</code></div>
</li>
<li class="level4"><div class="li"> al doilea argument se gƒÉse»ôte la adresa <code>ebp+12</code></div>
</li>
<li class="level4"><div class="li"> al treilea argument se gƒÉse»ôte la adresa <code>ebp+16</code></div>
</li>
<li class="level4"><div class="li"> etc.</div>
</li>
</ul>

<p>
Acesta este motivul pentru care, pentru a ob»õine parametrii func»õiei <code>foo</code> √Æn registrele <code>eax</code>, <code>ebx</code>, <code>ecx</code>, folosim construc»õiile:
</p>
<pre class="code">    mov eax, dword [ebp+8]   ; primul argument in eax
    mov ebx, dword [ebp+12]  ; al doilea argument in ebx
    mov ecx, dword [ebp+16]  ; al treilea argument in ecx</pre>

<p>
4. Valoare de retur a unei functii se plaseaza in registre (in general in eax).
</p>
<ul>
<li class="level1"><div class="li"> Daca valoarea de retur este pe <strong>8 biti</strong> rezultatul functiei se plaseaza in <code>al</code>.</div>
</li>
<li class="level1"><div class="li"> Daca valoarea de retur este pe <strong>16 biti</strong> rezultatul functiei se plaseaza in <code>ax</code>.</div>
</li>
<li class="level1"><div class="li"> Daca valoarea de retur este pe <strong>32 biti</strong> rezultatul functiei se plaseaza in <code>eax</code>.</div>
</li>
<li class="level1"><div class="li"> Daca valoarea de retur este pe <strong>64 biti</strong> rezultatul se plaseaza in registrele <code>edx</code> si <code>eax</code>. Cei mai semnificativi 32 de biti se plaseaza in <code>edx</code>, iar restul in registrul <code>eax</code>.</div>
</li>
</ul>

<p>
   <em>De asemnea, in unele cazuri, se poate returna o adresa de memorie
 catre stiva/heap, sau alte zone de memorie, care refera obiectul dorit 
in urma apelului functiei.</em>
</p>

<p>
5. O functie foloseste aceleasi registre hardware, asadar, la iesirea 
din functie valorile registrelor nu mai sunt aceleasi. Pentru a evita 
aceasta situatie, se pot salva unele/toate registrele pe stiva.
</p>

<p>
</p><p></p><div class="noteclassic"> Deoarece limbajele de asamblare 
ofera mai multe oportunitati, exista necesitatea de a avea conventii de 
apelare a functiilor in x86. Diferenta dintre acestea poate consta in 
ordinea parametrilor, modul cum parametrii sunt pasati functiei, ce 
registre trebuiesc conservate de apelat sau daca apelantul ori apelatul 
se ocupa de pregatirea stivei. Mai multe detalii puteti gasi <a href="https://en.wikipedia.org/wiki/X86_calling_conventions" class="urlextern" title="https://en.wikipedia.org/wiki/X86_calling_conventions" rel="nofollow">aici</a> sau <a href="https://levelup.gitconnected.com/x86-calling-conventions-a34812afe097" class="urlextern" title="https://levelup.gitconnected.com/x86-calling-conventions-a34812afe097" rel="nofollow">aici</a> daca wikipedia e prea mainstream pentru voi. 
</div><p></p>
<p></p>

</div>

<h2 class="sectionedit8" id="exercitii">Exerci»õii</h2>
<div class="level2">

<p>
</p><p></p><div class="noteimportant"> √én cadrul laboratoarelor vom folosi repository-ul de git al materiei <a href="https://github.com/systems-cs-pub-ro/iocla" class="urlextern" title="https://github.com/systems-cs-pub-ro/iocla" rel="nofollow">IOCLA</a>. Repository-ul este clonat pe desktop-ul ma»ôinii virtuale. Pentru a √Æl actualiza, folosi»õi comanda <code>git pull origin master</code> din interiorul directorului √Æn care se aflƒÉ repository-ul (<code>~/Desktop/iocla</code>).
 Recomandarea este sƒÉ √Æl actualiza»õi c√¢t mai frecvent, √Ænainte sƒÉ 
√Æncepe»õi lucrul, pentru a vƒÉ asigura cƒÉ ave»õi versiunea cea mai 
recentƒÉ.DacƒÉ dori»õi sƒÉ descƒÉrca»õi repository-ul √Æn altƒÉ loca»õie, 
folosi»õi comanda <code>git clone https://github.com/systems-cs-pub-ro/iocla ${target}</code>. Pentru mai multe informa»õii despre folosirea utilitarului git, urma»õi ghidul de la <a href="https://gitimmersion.com/" class="urlextern" title="https://gitimmersion.com/" rel="nofollow">Git Immersion</a> 
</div><p></p>
<p></p>

</div>

<h3 class="sectionedit9" id="recapitularesirul_lui_fibonacci">0. Recapitulare: »òirul lui Fibonacci</h3>
<div class="level3">

<p>
Completa»õi fi»ôierul <code>fibo.asm</code> din arhivƒÉ pentru a realiza un program care afi»ôeazƒÉ primele N numere din »ôirul lui Fibonacci.
</p>

<p>
Ave»õi voie sƒÉ folosi»õi doar memorie alocatƒÉ pe stivƒÉ.
</p>

</div>

<h3 class="sectionedit10" id="hello_world">1. Hello, world!</h3>
<div class="level3">

<p>
Deschide»õi fi»ôierul <code>hello-world.asm</code>, asambla»õi-l »ôi rula»õi-l. Observa»õi afi»ôarea mesajului <em>Hello, world!</em>
</p>

<p>
Remarca»õi cƒÉ:
</p>
<ul>
<li class="level1"><div class="li"> Programul <code>hello-world.asm</code> folose»ôte apelul func»õiei <code>puts</code> (func»õie externƒÉ modulului curent) pentru a efectua afi»ôarea. Pentru aceasta pune argumentul pe stivƒÉ »ôi apeleazƒÉ func»õia.</div>
</li>
<li class="level1"><div class="li"> Variabila <code>msg</code> din programul <code>hello-world.asm</code> con»õine octetul <code>10</code>. Acesta simbolizeazƒÉ caracterul <em>line-feed</em> (<code>\n</code>), folosit pentru a adƒÉuga o linie nouƒÉ pe Linux.</div>
</li>
</ul>

<p>
√éncheierea cu <code>\n</code> este, √Æn general, utilƒÉ pentru afi»ôarea »ôirurilor. Func»õia <code>puts</code> pune automat o linie nouƒÉ dupƒÉ »ôirul afi»ôat, √ÆnsƒÉ aceasta trebuie adƒÉugatƒÉ explicit √Æn cazul folosirii func»õiei <code>printf</code>.
</p>

</div>

<h3 class="sectionedit11" id="dezasamblarea_unui_program_scris_in_c">2. Dezasamblarea unui program scris √Æn C</h3>
<div class="level3">

<p>
DupƒÉ cum spuneam, √Æn final, totul ajunge √Æn limbaj de asamblare (ca sƒÉ 
fim 100% corec»õi, totul ajunge cod ma»ôinƒÉ care are o coresponden»õƒÉ 
destul de bunƒÉ cu codul asamblare). Adesea ajungem sƒÉ avem acces doar la
 codul obiect al unor programe »ôi vrem sƒÉ inspectƒÉm modul √Æn care aratƒÉ.
</p>

<p>
Pentru a observa acest lucru, haide»õi sƒÉ compilƒÉm p√¢nƒÉ la codul obiect 
un program scris √Æn C »ôi apoi sƒÉ-l dezasamblƒÉm. Este vorba de programul <code>test.c</code> din arhiva de laborator.
</p>

<p>
</p><p></p><div class="noteclassic"> Pentru a compila un fi»ôier cod sursƒÉ C/C++ √Æn linia de comandƒÉ, urma»õi pa»ôii:
<p></p>
<ol>
<li class="level1"><div class="li"> Deschide»õi un terminal. (shortcut <code>Ctrl+Alt+T</code>)</div>
</li>
<li class="level1"><div class="li"> Accesa»õi directorul √Æn care ave»õi codul sursƒÉ.</div>
</li>
<li class="level1"><div class="li"> Folosi»õi comanda</div>
</li>
</ol>
<pre class="code">gcc -m32 -o &lt;executabil&gt; &lt;nume-fisier&gt;
</pre>

<p>
unde <code>&lt;nume-fisier&gt;</code> este numele fi»ôierului iar <code>&lt;executabil&gt;</code> este executabilul rezultat.
</p>
<ol>
<li class="level1"><div class="li"> DacƒÉ dori»õi <strong>doar</strong> sƒÉ compila»õi fi»ôierul (<strong>fƒÉrƒÉ</strong> sƒÉ-l link-a»õi), atunci folosi»õi comanda</div>
</li>
</ol>
<pre class="code">gcc -m32 -c -o &lt;fisier-obiect&gt; &lt;nume-fisier&gt;
</pre>

<p>
unde <code>&lt;nume-fisier&gt;</code> este numele fi»ôierului iar <code>&lt;fisier-obiect&gt;</code> este fi»ôierul obiect rezultat.

</p></div><p></p>
√én cazul nostru, √Æntruc√¢t dorim doar sƒÉ compilƒÉm fi»ôierul <code>test.c</code> la modulul obiect, vom accesa din terminal directorul √Æn care se gƒÉse»ôte fi»ôierul »ôi apoi vom rula comanda
<p></p>
<pre class="code">gcc -m32 -c -o test.o test.c
</pre>

<p>
√én urma rulƒÉrii comenzii de mai sus √Æn directorul curent vom avea fi»ôierul obiect <code>test.o</code>.
</p>

<p>
Putem ob»õine »ôi forma √Æn limbaj de asamblare a acestuia folosind comanda
</p>
<pre class="code">gcc -m32 -masm=intel -S -o test.asm test.c
</pre>

<p>
√én urma rulƒÉrii comenzii de mai sus ob»õinem fi»ôierul <code>test.asm</code> pe care √Æl putem vizualiza folosind comanda
</p>
<pre class="code">cat test.asm
</pre>

<p>
Pentru a dezasambla codul unui modul obiect vom folosi un utilitar frecvent √Ænt√¢lnit √Æn lumea Unix: <code>objdump</code>. Pentru dezasamblare, vom rula comanda
</p>
<pre class="code">objdump -M intel -d &lt;path-to-obj-file&gt;
</pre>

<p>
unde <code>&lt;path-to-obj-file&gt;</code> este calea cƒÉtre fi»ôierul obiect <code>test.o</code>.
</p>

<p>
Ve»õi ob»õine un output similar celui de mai jos
</p>
<pre class="code">$ objdump -M intel -d test.o

test.o:     file format elf32-i386

Disassembly of section .text:

0000054d &lt;second_func&gt;:
 54d:   55                      push   ebp
 54e:   89 e5                   mov    ebp,esp
 550:   e8 a6 00 00 00          call   5fb &lt;__x86.get_pc_thunk.ax&gt;
 555:   05 ab 1a 00 00          add    eax,0x1aab
 55a:   8b 45 08                mov    eax,DWORD PTR [ebp+0x8]
 55d:   8b 10                   mov    edx,DWORD PTR [eax]
 55f:   8b 45 0c                mov    eax,DWORD PTR [ebp+0xc]
 562:   01 c2                   add    edx,eax
 564:   8b 45 08                mov    eax,DWORD PTR [ebp+0x8]
 567:   89 10                   mov    DWORD PTR [eax],edx
 569:   90                      nop
 56a:   5d                      pop    ebp
 56b:   c3                      ret

0000056c &lt;first_func&gt;:
 56c:   55                      push   ebp
 56d:   89 e5                   mov    ebp,esp
 56f:   53                      push   ebx
 570:   83 ec 14                sub    esp,0x14
 573:   e8 83 00 00 00          call   5fb &lt;__x86.get_pc_thunk.ax&gt;
 578:   05 88 1a 00 00          add    eax,0x1a88
 57d:   c7 45 f4 03 00 00 00    mov    DWORD PTR [ebp-0xc],0x3
 584:   83 ec 0c                sub    esp,0xc
 587:   8d 90 80 e6 ff ff       lea    edx,[eax-0x1980]
 58d:   52                      push   edx
 58e:   89 c3                   mov    ebx,eax
 590:   e8 4b fe ff ff          call   3e0 &lt;puts@plt&gt;
 595:   83 c4 10                add    esp,0x10
 598:   83 ec 08                sub    esp,0x8
 59b:   ff 75 f4                push   DWORD PTR [ebp-0xc]
 59e:   8d 45 08                lea    eax,[ebp+0x8]
 5a1:   50                      push   eax
 5a2:   e8 a6 ff ff ff          call   54d &lt;second_func&gt;
 5a7:   83 c4 10                add    esp,0x10
 5aa:   8b 45 08                mov    eax,DWORD PTR [ebp+0x8]
 5ad:   8b 5d fc                mov    ebx,DWORD PTR [ebp-0x4]
 5b0:   c9                      leave
 5b1:   c3                      ret

000005b2 &lt;main&gt;:
 5b2:   8d 4c 24 04             lea    ecx,[esp+0x4]
 5b6:   83 e4 f0                and    esp,0xfffffff0
 5b9:   ff 71 fc                push   DWORD PTR [ecx-0x4]
 5bc:   55                      push   ebp
 5bd:   89 e5                   mov    ebp,esp
 5bf:   53                      push   ebx
 5c0:   51                      push   ecx
 5c1:   e8 8a fe ff ff          call   450 &lt;__x86.get_pc_thunk.bx&gt;
 5c6:   81 c3 3a 1a 00 00       add    ebx,0x1a3a
 5cc:   83 ec 0c                sub    esp,0xc
 5cf:   6a 0f                   push   0xf
 5d1:   e8 96 ff ff ff          call   56c &lt;first_func&gt;
 5d6:   83 c4 10                add    esp,0x10
 5d9:   83 ec 08                sub    esp,0x8
 5dc:   50                      push   eax
 5dd:   8d 83 8e e6 ff ff       lea    eax,[ebx-0x1972]
 5e3:   50                      push   eax
 5e4:   e8 e7 fd ff ff          call   3d0 &lt;printf@plt&gt;
 5e9:   83 c4 10                add    esp,0x10
 5ec:   b8 00 00 00 00          mov    eax,0x0
 5f1:   8d 65 f8                lea    esp,[ebp-0x8]
 5f4:   59                      pop    ecx
 5f5:   5b                      pop    ebx
 5f6:   5d                      pop    ebp
 5f7:   8d 61 fc                lea    esp,[ecx-0x4]
 5fa:   c3                      ret
</pre>

<p>
ExistƒÉ multe alte utilitare care permit dezasamblare de module obiect, 
majoritatea cu interfa»õa graficƒÉ »ôi oferind »ôi suport pentru debugging. <code>objdump</code> este un utilitar simplu care poate fi rapid folosit √Æn linia de comandƒÉ.
</p>

<p>
Este interesant de urmƒÉrit, at√¢t √Æn fi»ôierul <code>test.asm</code> c√¢t »ôi √Æn dezasamblarea sa, modul √Æn care se face un apel de func»õie, lucru despre care vom discuta √Æn continuare.
</p>

</div>

<h3 class="sectionedit12" id="afisarea_unui_sir">3. Afi»ôarea unui »ôir</h3>
<div class="level3">

<p>
Pentru afi»ôarea unui string putem folosi macro-ul intern <code>PRINTF32</code>. Sau putem folosi o func»õie precum <code>puts</code>. √én fi»ôierul <code>print-string.asm</code> este implementatƒÉ afi»ôarea unui string folosind macro-ul <code>PRINTF32</code>.
</p>

<p>
UrmƒÉrind fi»ôierul <code>hello-world.asm</code> ca exemplu, implementa»õi afi»ôarea »ôirului folosind »ôi <code>puts</code>.
</p>

<p>
</p><p></p><div class="noteclassic"> UrmƒÉri»õi »ôi indica»õiile din sec»õiunea <em>‚ÄúApelul unei func»õii‚Äù</em>. 
</div><p></p>
<p></p>

</div>

<h3 class="sectionedit13" id="afisarea_lungimii_unui_sir">4. Afi»ôarea lungimii unui »ôir</h3>
<div class="level3">

<p>
Programul <code>print-string-len.asm</code> afi»ôeazƒÉ lungimea unui »ôir folosind macro-ul <code>PRINTF32</code>. Calculul lungimii »ôirului <code>mystring</code> are loc √Æn cadrul programului (este deja implementat).
</p>

<p>
Implementa»õi programul pentru a face afi»ôarea lungimii »ôirului folosind func»õia <code>printf</code>.
</p>

<p>
La sf√¢r»ôit ve»õi avea afi»ôatƒÉ de douƒÉ ori lungimea »ôirului: ini»õial cu apelul macro-ului <code>PRINTF32</code> »ôi apoi cu apelul func»õiei externe <code>printf</code>.
</p>

<p>
</p><p></p><div class="noteclassic"> G√¢ndi»õi-vƒÉ cƒÉ apelul <code>printf</code> este de forma <code>printf("String length is %u\n", len);</code>. Trebuie sƒÉ construi»õi stiva pentru acest apel.
<p></p>

<p>
Pa»ôii de urmat sunt:
</p>
<ol>
<li class="level1"><div class="li"> Marcarea simbolului <code>printf</code> ca simbol extern.</div>
</li>
<li class="level1"><div class="li"> Definirea »ôirului de formatare <code>"String length is %u", 10, 0</code>.</div>
</li>
<li class="level1"><div class="li"> Realizarea apelului func»õiei <code>printf</code>, adicƒÉ:</div>
<ol>
<li class="level2"><div class="li"> Punerea celor douƒÉ argumente pe stivƒÉ: »ôirul de formatarea »ôi lungimea.</div>
</li>
<li class="level2"><div class="li"> Apelul <code>printf</code> folosind <code>call</code>.</div>
</li>
<li class="level2"><div class="li"> Restaurarea stivei.</div>
</li>
</ol>
</li>
</ol>

<p>
Lungimea »ôirului se gƒÉse»ôte √Æn registrul <code>ecx</code>.

</p></div><p></p>
<p></p>

</div>

<h3 class="sectionedit14" id="afisarea_sirului_inversat">5. Afi»ôarea »ôirului inversat</h3>
<div class="level3">

<p>
√én solu»õia de mai sus adƒÉuga»õi func»õia <code>reverse_string</code> astfel √Ænc√¢t sƒÉ ave»õi un listing similar celui de mai jos:
</p>
<pre class="code">[...]
section .text
global main

reverse_string:
    push ebp
    mov ebp, esp

    mov eax, dword [ebp+8]
    mov ecx, dword [ebp+12]
    add eax, ecx
    dec eax
    mov edx, dword [ebp+16]

copy_one_byte:
    mov bl, byte [eax]
    mov byte [edx], bl
    dec eax
    inc edx
    loopnz copy_one_byte

    inc edx
    mov byte [edx], 0

    leave
    ret

main:
    push ebp
    mov ebp, esp
[...]
</pre>

<p>
</p><p></p><div class="noteimportant"> C√¢nd copia»õi func»õia <code>reverse_string</code> √Æn programul vostru, re»õine»õi cƒÉ fuc»õia √Æncepe la eticheta <code>reverse_string</code> »ôi se opre»ôte la eticheta <code>main</code>. Eticheta <code>copy_one_byte</code> este parte a func»õiei <code>reverse_string</code>. 
</div><p></p>
<p></p>

<p>
Func»õia <code>reverse_string</code> inverseazƒÉ un »ôir »ôi are urmƒÉtoarea signaturƒÉ: <code>void reverse_string(const char *src, size_t len, char *dst);</code>. Astfel ca primele <code>len</code> caractere »ôi »ôirul <code>src</code> sunt inversate √Æn »ôirul <code>dst</code>.
</p>

<p>
Realiza»õi inversarea »ôirului <code>mystring</code> √Æntr-un nou »ôir »ôi afi»ôa»õi acel nou »ôir.
</p>

<p>
</p><p></p><div class="noteclassic">
Pentru a defini un nou »ôir, recomandƒÉm ca, √Æn sec»õiunea de date sƒÉ folosi»õi construc»õia
<p></p>
<pre class="code">store_string times 64 db 0
</pre>

<p>
Construc»õia creeazƒÉ un »ôir de 64 de octe»õi de zero, suficient pentru a stoca inversul »ôirului.
Apelul echivalent √Æn C al func»õiei este <code>reverse_string(mystring, ecx, store_string);</code>. √én registrul <code>ecx</code> am presupus cƒÉ este calculatƒÉ lungimea »ôirului.
</p>

<p>
Nu pute»õi folosi direct valoarea <code>ecx</code> √Æn forma ei curentƒÉ. DupƒÉ apelul func»õiei <code>printf</code> pentru afi»ôare numƒÉrului valoarea <code>ecx</code> se pierde. Ca sƒÉ o pƒÉstra»õi, ave»õi douƒÉ op»õiuni:
</p>
<ol>
<li class="level1"><div class="li"> Stoca»õi valoarea registrului <code>ecx</code> √Æn prealabil pe stivƒÉ (folosind <code>push ecx</code> √Ænaintea apelului <code>printf</code>) »ôi apoi sƒÉ o restaura»õi dupƒÉ apelul <code>printf</code> (folosind <code>pop ecx</code>).</div>
</li>
<li class="level1"><div class="li"> Stoca»õi valoarea registrului <code>ecx</code> √Æntr-o variabilƒÉ globalƒÉ, pe care o defini»õi √Æn sec»õiunea <code>.data</code>.</div>
</li>
</ol>

<p>
Nu pute»õi folosi un alt registru pentru cƒÉ sunt »ôanse foarte mari ca »ôi acel registru sƒÉ fie modificat de apelul <code>printf</code> pentru afi»ôarea lungimii »ôirului.

</p></div><p></p>
<p></p>

</div>

<h3 class="sectionedit15" id="implementarea_functiei_toupper">6. Implementarea func»õiei toupper</h3>
<div class="level3">

<p>
Ne propunem implementarea func»õiei <code>toupper</code> care traduce literele mici √Æn litere mari. Pentru aceasta, porni»õi de la fi»ôierul <code>toupper.asm</code> din arhiva de exerci»õii a laboratorului »ôi completa»õi corpul func»õiei <code>toupper</code>.
</p>

<p>
»òirul folosit este <code>mystring</code> »ôi presupunem cƒÉ este un »ôir valid. Acest »ôir este transmis ca argument func»õiei <code>toupper</code> √Æn momentul apelului.
</p>

<p>
Face»õi √Ænlocuirea <em>in place</em>, nu este nevoie de un alt »ôir.
</p>

<p>
</p><p></p><div class="noteclassic"> Ca sƒÉ traduce»õi o litera micƒÉ √Æn literƒÉ mare, trebuie sƒÉ <strong>scƒÉde»õi</strong> <code>0x20</code> din valoare. Aceasta este diferen»õa √Æntre litere mici »ôi mari; de exemplu <code>a</code> este <code>0x61</code> iar <code>A</code> este <code>0x41</code>. Pute»õi vedea √Æn <a href="http://man7.org/linux/man-pages/man7/ascii.7.html" class="urlextern" title="http://man7.org/linux/man-pages/man7/ascii.7.html" rel="nofollow">pagina de manual ascii</a>.
<p></p>

<p>
a sƒÉ citi»õi sau sƒÉ scrie»õi octet cu octet folosi»õi construc»õia <code>byte [reg]</code> a»ôa cum apare »ôi √Æn implementarea determinƒÉrii lungimii unui »ôir √Æn fi»ôierul <code>print-string-len.asm</code>, unde <code>[reg]</code> este registrul de tip pointer √Æn care este stocatƒÉ adresa »ôirului √Æn acel punct.
</p>

<p>
VƒÉ opri»õi atunci c√¢nd a»õi ajuns la valoarea <code>0</code> (<code>NULL</code> byte). Pentru verificare pute»õi folosi <code>test</code> a»ôa cum se √Ænt√¢mplƒÉ »ôi √Æn implementarea determinƒÉrii lungimii unui »ôir √Æn fi»ôierul <code>print-string-len.asm</code>. 
</p></div><p></p>
<p></p>

</div>

<h3 class="sectionedit16" id="bonustoupper_doar_pentru_litere_mici">Bonus: toupper doar pentru litere mici</h3>
<div class="level3">

<p>
Implementa»õi func»õia <code>toupper</code> astfel √Ænc√¢t translatarea sƒÉ 
aibƒÉ loc doar pentru caractare reprezent√¢nd litere mici, nu litere mari 
sau alte tipuri de caractere.
</p>

</div>

<h3 class="sectionedit17" id="bonusrot13">Bonus: rot13</h3>
<div class="level3">

<p>
Realiza»õi »ôi folosi»õi o func»õie care face translatarea <a href="https://rot13.com/" class="urlextern" title="https://rot13.com/" rel="nofollow">rot13</a> a unui »ôir.
</p>

</div>

<h3 class="sectionedit18" id="bonusrot131">Bonus: rot13++</h3>
<div class="level3">

<p>
Implementa»õi <code>rot13</code> pe un array de »ôiruri: »ôirurile sunt continue √Æn memorie separate prin terminatorul de »ôir (<code>NULL</code>-byte, <code>0</code>). De exemplu: <code>ana\0are\0mere\0</code> este un array de trei »ôiruri.
</p>

<p>
Aplica»õi <code>rot13</code> pe caracterele alfabetice »ôi √Ænlocui»õi terminatorul de »ôir cu spa»õiu (<code>' '</code>, blank, caracterul <code>32</code> sau <code>0x20</code>). Astfel, »ôirul ini»õial <code>ana\0are\0mere\0</code> se va traduce √Æn <code>nan ner zrer</code>.
</p>

<p>
</p><p></p><div class="noteclassic"> Pentru a defini array-ul de »ôiruri care sƒÉ con»õinƒÉ terminatorul de »ôir, folosi»õi o construc»õie de forma:
<p></p>
<pre class="code">mystring db "ana", 0, "are", 0, "mere", 0
</pre>

<p>

</p></div><p></p>
<p></p><div class="noteclassic"> Va trebui sƒÉ »ôti»õi c√¢nd sa vƒÉ opri»õi 
din parcurgerea array-ului de »ôiruri. Cel mai simplu este sƒÉ defini»õi o 
variabilƒÉ de lungime √Æn sec»õiunea <code>.data</code>, de forma
<p></p>
<pre class="code">len dd 10
</pre>

<p>
√Æn care sƒÉ re»õine»õi fie lungimea totalƒÉ a »ôirului (de la √Ænceputul p√¢nƒÉ la ultimul <code>NULL</code>-byte), fie numƒÉrul de »ôiruri din array.

</p></div><p></p>
<p></p>

</div>

<h2 class="sectionedit19" id="alte_resurse">Alte resurse</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="http://www.nasm.us/" class="urlextern" title="http://www.nasm.us/" rel="nofollow">nasm</a></div>
</li>
</ul>

</div>

<h2 class="sectionedit20" id="solutii">Solu»õii</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Solu»õiile pentru exerci»õii sunt disponibile <a href="https://elf.cs.pub.ro/asm/res/laboratoare/lab-09-sol.zip" class="urlextern" title="https://elf.cs.pub.ro/asm/res/laboratoare/lab-09-sol.zip" rel="nofollow">aici</a>.</div>
</li>
</ul>

</div>

        </div>
        <div class="right_sidebar">
          <form action="/courses/start" accept-charset="utf-8" class="search" id="dw__search" method="get"><div class="no"><input type="hidden" name="do" value="search"><input type="text" id="qsearch__in" accesskey="f" name="id" class="edit" title="[F]"><input type="submit" value="Search" class="button" title="Search"><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>          <div class="namespace_sidebar sidebar_box">



<div><div id="nojs_indexmenu_88084918362b0bf6a408bd" data-jsajax="%26skipfile%3D%252B/iocla%253A%2528sidebar%257Cindex%257Cdraft-reguli-si-notare%257CCatalog%2529/" class="indexmenu_nojs">

<ul class="idx">
<li class="level1"><div class="li"><a href="https://ocw.cs.pub.ro/courses/iocla/anunturi" class="wikilink1" title="iocla:anunturi">Anun»õuri</a></div></li>
<li class="level1"><div class="li"><a href="https://ocw.cs.pub.ro/courses/iocla/bune-practici" class="wikilink1" title="iocla:bune-practici">Bune practici</a></div></li>
<li class="level1"><div class="li"><a href="https://ocw.cs.pub.ro/courses/iocla/calendar" class="wikilink1" title="iocla:calendar">Calendar</a></div></li>
<li class="level1"><div class="li"><a href="https://ocw.cs.pub.ro/courses/iocla/catalog" class="wikilink1" title="iocla:catalog">Catalog</a></div></li>
<li class="level1"><div class="li"><a href="https://ocw.cs.pub.ro/courses/iocla/feed" class="wikilink1" title="iocla:feed">Feed RSS</a></div></li>
<li class="level1"><div class="li"><a href="https://ocw.cs.pub.ro/courses/iocla/need-to-know" class="wikilink1" title="iocla:need-to-know">IOCLA Need to Know</a></div></li>
<li class="level1"><div class="li"><a href="https://ocw.cs.pub.ro/courses/iocla/reguli-notare" class="wikilink1" title="iocla:reguli-notare">Reguli »ôi notare</a></div></li>
<li class="level1"><div class="li"><a href="https://ocw.cs.pub.ro/courses/iocla/utile" class="wikilink1" title="iocla:utile">Resurse utile</a></div></li>
</ul>
</div></div>

<h1 class="sectionedit1" id="cursuri">Cursuri</h1>
<div class="level1">
<ul>
<li class="level1"><div class="li"> <a href="https://ocw.cs.pub.ro/courses/iocla/cursuri/capitol-00" class="wikilink1" title="iocla:cursuri:capitol-00">Capitol 00: Prezentare</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://ocw.cs.pub.ro/courses/iocla/cursuri/capitol-01" class="wikilink1" title="iocla:cursuri:capitol-01">Capitol 01: Programe »ôi sistemul de calcul</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://ocw.cs.pub.ro/courses/iocla/cursuri/capitol-02" class="wikilink1" title="iocla:cursuri:capitol-02">Capitol 02: Construirea programelor</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://ocw.cs.pub.ro/courses/iocla/cursuri/capitol-03" class="wikilink1" title="iocla:cursuri:capitol-03">Capitol 03: Arhitectura sistemului de calcul</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://ocw.cs.pub.ro/courses/iocla/cursuri/capitol-04" class="wikilink1" title="iocla:cursuri:capitol-04">Capitol 04: Reprezentarea numerelor</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://ocw.cs.pub.ro/courses/iocla/cursuri/capitol-05" class="wikilink1" title="iocla:cursuri:capitol-05">Capitol 05: Interfa»õa hardware - software x86</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://ocw.cs.pub.ro/courses/iocla/cursuri/capitol-06" class="wikilink1" title="iocla:cursuri:capitol-06">Capitol 06: Stiva</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://ocw.cs.pub.ro/courses/iocla/cursuri/capitol-07" class="wikilink1" title="iocla:cursuri:capitol-07">Capitol 07: Func»õii</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://ocw.cs.pub.ro/courses/iocla/cursuri/capitol-08" class="wikilink1" title="iocla:cursuri:capitol-08">Capitol 08: Interfa»õa binarƒÉ a func»õiilor</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://ocw.cs.pub.ro/courses/iocla/cursuri/capitol-09" class="wikilink1" title="iocla:cursuri:capitol-09">Capitol 09: Gestiunea bufferelor</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://ocw.cs.pub.ro/courses/iocla/cursuri/capitol-10" class="wikilink1" title="iocla:cursuri:capitol-10">Capitol 10: Curs ales de titular</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://ocw.cs.pub.ro/courses/iocla/cursuri/capitol-11" class="wikilink1" title="iocla:cursuri:capitol-11">Capitol 11: OptimizƒÉri</a></div>
</li>
</ul>

</div>
<!-- EDIT1 SECTION "Cursuri" [197-1100] -->
<h1 class="sectionedit2" id="laboratoare">Laboratoare</h1>
<div class="level1">
<ul>
<li class="level1"><div class="li"> <a href="https://ocw.cs.pub.ro/courses/iocla/laboratoare/laborator-01" class="wikilink1" title="iocla:laboratoare:laborator-01">Laborator 01: Reprezentarea numerelor, opera»õii pe bi»õi »ôi lucru cu memoria</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://ocw.cs.pub.ro/courses/iocla/laboratoare/laborator-02" class="wikilink1" title="iocla:laboratoare:laborator-02">Laborator 02: Opera»õii cu memoria. Introducere √Æn GDB</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://ocw.cs.pub.ro/courses/iocla/laboratoare/laborator-03" class="wikilink1" title="iocla:laboratoare:laborator-03">Laborator 03: Compilare</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://ocw.cs.pub.ro/courses/iocla/laboratoare/laborator-04" class="wikilink1" title="iocla:laboratoare:laborator-04">Laborator 04: Toolchain</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://ocw.cs.pub.ro/courses/iocla/laboratoare/laborator-05" class="wikilink1" title="iocla:laboratoare:laborator-05">Laborator 05: Introducere √Æn limbajul de asamblare</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://ocw.cs.pub.ro/courses/iocla/laboratoare/laborator-06" class="wikilink1" title="iocla:laboratoare:laborator-06">Laborator 06: Rolul registrelor, adresare directƒÉ »ôi bazatƒÉ</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://ocw.cs.pub.ro/courses/iocla/laboratoare/laborator-07" class="wikilink1" title="iocla:laboratoare:laborator-07">Laborator 07: Date Structurate. Structuri, vectori. Operatii pe siruri</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://ocw.cs.pub.ro/courses/iocla/laboratoare/laborator-08" class="wikilink1" title="iocla:laboratoare:laborator-08">Laborator 08: Lucrul cu stiva</a></div>
</li>
<li class="level1"><div class="li"> <span class="curid"><a href="https://ocw.cs.pub.ro/courses/iocla/laboratoare/laborator-09" class="wikilink1" title="iocla:laboratoare:laborator-09">Laborator 09: Apeluri de func»õii</a></span></div>
</li>
<li class="level1"><div class="li"> <a href="https://ocw.cs.pub.ro/courses/iocla/laboratoare/laborator-10" class="wikilink1" title="iocla:laboratoare:laborator-10">Laborator 10: Interactiunea C-assembly</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://ocw.cs.pub.ro/courses/iocla/laboratoare/laborator-11" class="wikilink1" title="iocla:laboratoare:laborator-11">Laborator 11: Gestiunea bufferelor. Buffer overflow</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://ocw.cs.pub.ro/courses/iocla/laboratoare/laborator-12" class="wikilink1" title="iocla:laboratoare:laborator-12">Laborator 12: CTF</a></div>
</li>
</ul>

<div><div id="nojs_indexmenu_12831697062b0bf6a471cb" data-jsajax="" class="indexmenu_nojs">

<ul class="idx">
<li class="level1"><div class="li"><a href="https://ocw.cs.pub.ro/courses/iocla/laboratoare/extra/laborator-arm" class="wikilink1" title="iocla:laboratoare:extra:laborator-arm">Laborator facultativ: ARM assembly</a></div></li>
</ul>
</div></div>

</div>
<!-- EDIT2 SECTION "Laboratoare" [1101-1658] -->
<h1 class="sectionedit3" id="teme">Teme</h1>
<div class="level1">
<ul>
<li class="level1"><div class="li"> <a href="https://ocw.cs.pub.ro/courses/iocla/teme/tema-1" class="wikilink1" title="iocla:teme:tema-1">Tema 1  - Momente disperate</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://ocw.cs.pub.ro/courses/iocla/teme/tema-2" class="wikilink1" title="iocla:teme:tema-2"> Tema 2 - ACS Cat Invasion</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://ocw.cs.pub.ro/courses/iocla/teme/tema-3" class="wikilink1" title="iocla:teme:tema-3"> Tema 3 - Poli Cat Invasion</a></div>
</li>
</ul>

</div>
<!-- EDIT3 SECTION "Teme" [1659-] -->
</div>
<div class="toc_sidebar sidebar_box">
<!-- TOC START -->
<div id="sb__right__dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="#laborator_09apeluri_de_functii">Laborator 09: Apeluri de func»õii</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="#cunostinte_si_abilitati_ce_vor_fi_dobandite">Cuno»ôtin»õe »ôi abilitƒÉ»õi ce vor fi dob√¢ndite</a></div></li>
<li class="level2"><div class="li"><a href="#transmiterea_parametrilor">Transmiterea Parametrilor</a></div></li>
<li class="level2"><div class="li"><a href="#apelul_unei_functii">Apelul unei func»õii</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="#functionarea_stivei">Func»õionarea stivei</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="#apelantul_si_apelatul">Apelantul si Apelatul</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="#remarcati">Remarcati:</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="#exercitii">Exerci»õii</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="#recapitularesirul_lui_fibonacci">0. Recapitulare: »òirul lui Fibonacci</a></div></li>
<li class="level3"><div class="li"><a href="#hello_world">1. Hello, world!</a></div></li>
<li class="level3"><div class="li"><a href="#dezasamblarea_unui_program_scris_in_c">2. Dezasamblarea unui program scris √Æn C</a></div></li>
<li class="level3"><div class="li"><a href="#afisarea_unui_sir">3. Afi»ôarea unui »ôir</a></div></li>
<li class="level3"><div class="li"><a href="#afisarea_lungimii_unui_sir">4. Afi»ôarea lungimii unui »ôir</a></div></li>
<li class="level3"><div class="li"><a href="#afisarea_sirului_inversat">5. Afi»ôarea »ôirului inversat</a></div></li>
<li class="level3"><div class="li"><a href="#implementarea_functiei_toupper">6. Implementarea func»õiei toupper</a></div></li>
<li class="level3"><div class="li"><a href="#bonustoupper_doar_pentru_litere_mici">Bonus: toupper doar pentru litere mici</a></div></li>
<li class="level3"><div class="li"><a href="#bonusrot13">Bonus: rot13</a></div></li>
<li class="level3"><div class="li"><a href="#bonusrot131">Bonus: rot13++</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="#alte_resurse">Alte resurse</a></div></li>
<li class="level2"><div class="li"><a href="#solutii">Solu»õii</a></div></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->
</div>
        </div>
      
    
      <div class="stylefoot">
        <div class="meta">
          <div class="user">
                    </div>
          <div class="doc">
          iocla/laboratoare/laborator-09.txt ¬∑ Last modified: 2022/05/06 15:02 by radu.nichita          </div>
        </div>
      </div>

    <div class="clearer"></div>

    
                <div class="bar" id="bar__bottom">
      <div class="bar-left">
        <a href="https://ocw.cs.pub.ro/courses/iocla/laboratoare/laborator-09?do=revisions" class="action revs" accesskey="o" rel="nofollow" title="Old revisions [O]">Old revisions</a>      </div>
      <div class="bar-right">
        <a href="https://ocw.cs.pub.ro/courses/iocla/laboratoare/laborator-09?do=media&amp;ns=iocla%3Alaboratoare" class="action media" rel="nofollow" title="Media Manager">Media Manager</a><a href="#dokuwiki__top" class="action top" accesskey="t" rel="nofollow" title="Back to top [T]">Back to top</a>      </div>
    </div>
    <div class="clearer"></div>
            
    <div class="footerinc" align="center">
  <div class="license"><a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="Laborator%2009%20Apeluri%20de%20func%C8%9Bii%20[CS%20Open%20CourseWare]_files/cc-by-sa.png" alt="CC Attribution-Share Alike 3.0 Unported"></a></div>
  <a target="_blank" href="http://www.chimeric.de/" title="www.chimeric.de"><img src="Laborator%2009%20Apeluri%20de%20func%C8%9Bii%20[CS%20Open%20CourseWare]_files/button-chimeric-de.png" alt="www.chimeric.de" width="80" height="15" border="0"></a>

  <a target="_blank" href="http://jigsaw.w3.org/css-validator/check/referer" title="Valid CSS"><img src="Laborator%2009%20Apeluri%20de%20func%C8%9Bii%20[CS%20Open%20CourseWare]_files/button-css.png" alt="Valid CSS" width="80" height="15" border="0"></a>

  <a target="_blank" href="http://wiki.splitbrain.org/wiki:dokuwiki" title="Driven by DokuWiki"><img src="Laborator%2009%20Apeluri%20de%20func%C8%9Bii%20[CS%20Open%20CourseWare]_files/button-dw.png" alt="Driven by DokuWiki" width="80" height="15" border="0"></a>

  <a target="_blank" href="http://www.firefox-browser.de/" title="do yourself a favour and use a real browser - get firefox"><img src="Laborator%2009%20Apeluri%20de%20func%C8%9Bii%20[CS%20Open%20CourseWare]_files/button-firefox.png" alt="do yourself a favour and use a real browser - get firefox!!" width="80" height="15" border="0"></a>
  
  <a target="_blank" href="https://ocw.cs.pub.ro/courses/feed.php" title="Recent changes RSS feed"><img src="Laborator%2009%20Apeluri%20de%20func%C8%9Bii%20[CS%20Open%20CourseWare]_files/button-rss.png" alt="Recent changes RSS feed" width="80" height="15" border="0"></a>

  <a target="_blank" href="http://validator.w3.org/check/referer" title="Valid XHTML 1.0"><img src="Laborator%2009%20Apeluri%20de%20func%C8%9Bii%20[CS%20Open%20CourseWare]_files/button-xhtml.png" alt="Valid XHTML 1.0" width="80" height="15" border="0"></a>
</div>

  </div>
</div>

<div class="no"><img src="Laborator%2009%20Apeluri%20de%20func%C8%9Bii%20[CS%20Open%20CourseWare]_files/indexer.gif" alt="" width="2" height="1"></div>


</body></html>